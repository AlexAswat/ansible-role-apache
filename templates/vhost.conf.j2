DirectoryIndex {{ item.index | default('index.html') }}

<VirtualHost *:{{ item.port | default('80') }}>
    DocumentRoot {{ item.documentroot }}
    ErrorLog {{ item.logDir | default('${APACHE_LOG_DIR}') }}/error.log
    CustomLog {{ item.logDir | default('${APACHE_LOG_DIR}') }}/access.log combined
    {% if item.serveradmin is defined %}ServerAdmin {{ item.serveradmin }}{% endif %}

    <Directory "{{ item.documentroot }}">
        AllowOverride All
        Options -Indexes +FollowSymLinks
        Order allow,deny
        Allow from all
        Require all granted

        RewriteEngine On
        RewriteCond %{REQUEST_URI}::$1 ^(/.+)/(.*)::\2$
        RewriteRule ^(.*) - [E=BASE:%1]
        RewriteCond %{ENV:REDIRECT_STATUS} ^$
        RewriteRule ^app\.php(/(.*)|$) %{ENV:BASE}/$2 [R=301,L]
        RewriteCond %{REQUEST_FILENAME} -f
        RewriteRule .? - [L]
        RewriteRule .? %{ENV:BASE}/app.php [L]

    </Directory>

    {% if item.extra_parameters is defined %}
      {{ item.extra_parameters }}
    {% endif %}

</VirtualHost>
